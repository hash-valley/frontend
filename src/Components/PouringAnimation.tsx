import gsap from "gsap";
import { useContext, useEffect } from "react";
import { ModalContext } from "../Hooks/ModalProvider";

export function removeSteps() {
  for (let i = 1; i <= 3; i++) {
    document.body.classList.remove(`step${i}`);
  }
}

export function resetGlassLevel() {
  for (let i = 1; i <= 3; i++) {
    gsap.to(`#glasslevel${i}`, {
      y: 308,
    });
  }
}

export const PouringAnimation = () => {
  const { modalIsOpen }: any = useContext(ModalContext);

  function delay(time: number) {
    return new Promise((resolve) => setTimeout(resolve, time));
  }

  async function hideStreamAndRestart(step: number) {
    document.body.classList.remove(`step${step}`);

    await delay(1000);

    if (step < 3 && modalIsOpen) {
      load(step + 1);
    }
  }

  async function load(step: number) {
    removeSteps();
    document.body.classList.add(`step${step}`);

    await delay(280);
    const stream = document.getElementById("stream");
    if (stream) {
      stream.style.visibility = "visible";
    }

    gsap.to(`#glasslevel${step}`, {
      y: -100,
      duration: 3,
      onComplete: () => {
        const stream = document.getElementById("stream");
        if (stream) {
          stream.style.visibility = "hidden";
        }
        hideStreamAndRestart(step);
      },
    });
  }

  useEffect(() => {
    load(1);
  }, []);

  return (
    <div id="wine-container">
      <svg viewBox="0 0 800 595" height={200} id="wine-bottle">
        <path
          d="M78.816 43.93 77.54 159.941l-15.936 7.65-8.924 5.099-11.473 18.485-4.462 256.246 31.233 11.474 33.784.637 60.556-8.286-1.912-244.77-10.836-30.596-18.485-12.11-11.474-5.1.637-116.65-41.432-2.55v4.462z"
          fill="#930"
          fillOpacity=".938"
          fillRule="evenodd"
          stroke="#000"
          strokeWidth=".4882"
        />
        <path
          d="m78.816 42.018 1.912 116.011-26.772 12.111-7.011 12.749-7.012 19.122-3.824 243.495 11.473 6.375 1.275-58.008 5.1-174.02s-1.754-21.671 14.023-28.683 36.922-.335 49.084.637c14.489 1.158 21.672-2.55 15.935-12.111-5.575-9.292-33.942 5.577-42.707-4.462s5.259-19.282 2.55-37.608-5.737-38.883-5.737-38.883.593-30.629 0-42.07c-.558-10.757 24.86-8.287 24.86-8.287v-5.099l-33.146-1.275z"
          fill="#966600"
          fillRule="evenodd"
        />
        <path
          d="M38.022 210.298c66.927 27.874 122.387 3.28 122.387 3.28l.637 232.016-38.883 13.937-72.029-5.739-14.023-12.209 1.912-231.285z"
          fillOpacity=".333"
          fillRule="evenodd"
        />
        <path
          d="M66.713 233.487c50.339 8.434 98.153-2.125 98.153-2.125v184.93s-20.873 10.63-48.825 11.34-49.328-7.797-49.328-7.797V233.489z"
          fill="#f8f3c8"
          fillRule="evenodd"
          stroke="#000"
          strokeWidth=".519933"
        />
        <path d="M84.246 36.163c-.152 9.067-1.175 14.785-.995 23.882.366 18.702-1.258 36.899.06 55.532 1.348 11.864-.242 24.15-.068 36.218 1.35 11.169-7.14 15.216-13.137 15.1-8.24-1.556-20.834 13.772-23.724 23.155-4.341 16.028-4.412 33.37-4.51 50.48-.065 22.261.023 44.524.038 66.785-.027 18.212.027 36.424.147 54.633-.447 7.76.88 15.923-.262 23.553-.514 3.47-.398 7.075-.387 10.616-.075 6.41-.12 12.817-.032 19.227.045 3.733.028 7.468.037 11.202 0 3.498-.008 6.995-.002 10.493-.001 2.001-.003 4.002.002 6.003l-8.864 7.122c.005-2.002.003-4.004.002-6.005.006-3.497-.002-6.993-.002-10.49.008-3.754-.008-7.508.037-11.262.085-6.39.048-12.778-.037-19.168.002-3.659-.11-7.36.284-10.98 1.447-7.517.324-15.746.746-23.499.12-18.29.174-36.58.147-54.87.014-22.272.077-44.544-.008-66.816-.034-17.22-.099-34.508 4-50.801 2.707-9.53 6.57-17.486 12.263-22.988 9.288-8.571 16.982-15.716 27.975-15.408 11.957-.85-7.07 15.55-3.498.975.106-12.142 2.56-24.134 2.388-36.055-1.387-18.66 2.12-37.064 1.612-55.795-.269-8.984-.954-22.37-9.137-27.032l14.925-3.81zM115.81 37.484c.152 9.067 1.175 14.784.996 23.881-.367 18.702 1.258 36.9-.061 55.533-1.348 11.863.242 24.15.068 36.218-1.35 11.168 7.14 15.215 13.138 15.1 8.239-1.557 24.94 13.16 11.072.829 5.714 5.373 9.762 12.942 12.651 22.325 4.341 16.028 4.412 33.372 4.51 50.48.065 22.262-.023 44.524-.038 66.785.027 18.212-.027 36.424-.147 54.633.447 7.76-.88 15.923.262 23.553.514 3.47.398 7.076.387 10.617.075 6.41.12 12.817.032 19.226-.045 3.734-.028 7.469-.037 11.202 0 3.498.009 6.996.002 10.494.001 2 .003 4.002-.002 6.002l8.864 7.123c-.005-2.002-.003-4.004-.002-6.006-.006-3.496.002-6.993.002-10.49-.008-3.754.008-7.508-.037-11.261-.085-6.39-.048-12.779.037-19.168-.002-3.66.111-7.36-.284-10.98-1.447-7.517-.324-15.746-.746-23.5-.12-18.289-.174-36.58-.147-54.87-.014-22.271-.077-44.543.008-66.816.034-17.22.099-34.508-3.999-50.8-2.708-9.531-6.57-17.486-12.264-22.988-9.287-8.572-16.982-15.716-27.975-15.409-11.956-.85 7.07 15.551 3.498.976-.106-12.142-2.56-24.134-2.388-36.055 1.387-18.661-2.12-37.064-1.612-55.796.269-8.984.954-22.37 9.137-27.032l-14.925-3.81z" />
        <path d="M167.344 450.816c-.832 4.964-1.84 4.731-12.614 7.456s-35.813 5.106-46.684 5.534c-12.115.1-24.231-.049-36.348.035-9.13-.571-17.118-1.975-24.149-3.93s-14.138-9.03-15.056-9.779l6.318-10.256c.887.728 4.253 4.479 5.165 5.178 3.822 3.27 8.112 6.545 15.039 8.339s22.887 3.161 31.937 3.258c12.135.092 18.675.024 30.687-1.778 38.213-6.552 34.122-5.536 38.964-14.122l6.742 10.065zM118.377 52.974c-3.761-7.514-12.158-8.748-20.61-7.815-5.004.628-14.01-2.544-19.046-2.465l5.288-6.49c4.893.026 8.425 2.953 13.293 2.423 8.69-.867 9.837-1.148 18.58-1.106l2.495 15.453z" />
        <path
          d="M150.21 180.976s3.74 240.922-3.824 254.333c-7.012 12.43-12.59.956-31.234 5.1S57.784 456.98 57.784 456.98l44.62 5.1 59.916-12.112-.637-251.784-11.474-17.21z"
          fillOpacity=".167"
          fillRule="evenodd"
        />
        <path
          d="M110.91 41.156s1.348 90.064 1.69 121.338c.095 8.443 22.686 6.546 22.686 6.546l-9.3-5.271-6.375-15.298V44.57l-8.7-3.41z"
          fillOpacity=".204"
          fillRule="evenodd"
        />
      </svg>
      <svg width="100%" viewBox="0 0 800 395" style={{ maxWidth: 200 }}>
        <g id="glass-container">
          <g id="glass1">
            <path
              d="M7.72 0S.001 64.209.001 113c0 43.333 24.348 73.509 66.293 73.509 40.874 0 66.291-30.177 66.291-73.509 0-48.795-7.718-113-7.718-113H7.717zm3.308 3.14h110.53s7.284 67.417 7.284 109.16c0 37.073-28.021 55.534-62.55 55.534S3.742 149.373 3.742 112.3c0-41.746 7.284-109.16 7.284-109.16zm40.764 185.38c2.504 2.438 4.696 4.959 6.181 7.853.044.085.058.182.1.267.968 2.274 1.579 4.735 1.905 7.351v164.66c-4.875 6.463-11.19 10.186-18.21 12.296-13.39 2.834-30.406 1.313-39.862 2.205h-.033l-.3 2.774h129.34l-.302-2.774h-.033c-9.456-.892-26.472.629-39.862-2.205-7.02-2.11-13.335-5.833-18.21-12.296v-164.66c.326-2.616.937-5.077 1.905-7.35.036-.086.062-.183.1-.268 1.485-2.894 3.677-5.415 6.181-7.852-4.794.604-9.62 1.063-14.435 1.136h-.033c-4.815-.072-9.64-.532-14.435-1.136z"
              fillRule="evenodd"
            />
          </g>
          <g id="glass2">
            <path
              d="M7.72 0S.001 64.209.001 113c0 43.333 24.348 73.509 66.293 73.509 40.874 0 66.291-30.177 66.291-73.509 0-48.795-7.718-113-7.718-113H7.717zm3.308 3.14h110.53s7.284 67.417 7.284 109.16c0 37.073-28.021 55.534-62.55 55.534S3.742 149.373 3.742 112.3c0-41.746 7.284-109.16 7.284-109.16zm40.764 185.38c2.504 2.438 4.696 4.959 6.181 7.853.044.085.058.182.1.267.968 2.274 1.579 4.735 1.905 7.351v164.66c-4.875 6.463-11.19 10.186-18.21 12.296-13.39 2.834-30.406 1.313-39.862 2.205h-.033l-.3 2.774h129.34l-.302-2.774h-.033c-9.456-.892-26.472.629-39.862-2.205-7.02-2.11-13.335-5.833-18.21-12.296v-164.66c.326-2.616.937-5.077 1.905-7.35.036-.086.062-.183.1-.268 1.485-2.894 3.677-5.415 6.181-7.852-4.794.604-9.62 1.063-14.435 1.136h-.033c-4.815-.072-9.64-.532-14.435-1.136z"
              fillRule="evenodd"
            />
          </g>
          <g id="glass3">
            <path
              d="M7.72 0S.001 64.209.001 113c0 43.333 24.348 73.509 66.293 73.509 40.874 0 66.291-30.177 66.291-73.509 0-48.795-7.718-113-7.718-113H7.717zm3.308 3.14h110.53s7.284 67.417 7.284 109.16c0 37.073-28.021 55.534-62.55 55.534S3.742 149.373 3.742 112.3c0-41.746 7.284-109.16 7.284-109.16zm40.764 185.38c2.504 2.438 4.696 4.959 6.181 7.853.044.085.058.182.1.267.968 2.274 1.579 4.735 1.905 7.351v164.66c-4.875 6.463-11.19 10.186-18.21 12.296-13.39 2.834-30.406 1.313-39.862 2.205h-.033l-.3 2.774h129.34l-.302-2.774h-.033c-9.456-.892-26.472.629-39.862-2.205-7.02-2.11-13.335-5.833-18.21-12.296v-164.66c.326-2.616.937-5.077 1.905-7.35.036-.086.062-.183.1-.268 1.485-2.894 3.677-5.415 6.181-7.852-4.794.604-9.62 1.063-14.435 1.136h-.033c-4.815-.072-9.64-.532-14.435-1.136z"
              fillRule="evenodd"
            />
          </g>
        </g>
        <path
          id="glasspath1"
          fill="rgb(72, 22, 28)"
          d="M335 230
     L465 230
     C465 230, 465 310, 400 310
     C335 310, 335 230, 335 230
     Z"
          clipPath="url(#glassmask1)"
        />
        <path
          id="glasspath2"
          fill="rgb(72, 22, 28)"
          d="M335 230
     L465 230
     C465 230, 465 310, 400 310
     C335 310, 335 230, 335 230
     Z"
          clipPath="url(#glassmask2)"
        />
        <path
          id="glasspath3"
          fill="rgb(72, 22, 28)"
          d="M335 230
     L465 230
     C465 230, 465 310, 400 310
     C335 310, 335 230, 335 230
     Z"
          clipPath="url(#glassmask3)"
        />
        <defs>
          <clipPath id="glassmask1">
            <rect
              id="glasslevel1"
              x={258}
              y={308}
              width={200}
              height={150}
              fill="rgb(72, 22, 28)"
            />
          </clipPath>
          <clipPath id="glassmask2">
            <rect
              id="glasslevel2"
              x={264}
              y={308}
              width={200}
              height={150}
              fill="rgb(72, 22, 28)"
            />
          </clipPath>
          <clipPath id="glassmask3">
            <rect
              id="glasslevel3"
              x={300}
              y={308}
              width={200}
              height={150}
              fill="rgb(72, 22, 28)"
            />
          </clipPath>
        </defs>
      </svg>
      <svg id="stream-container">
        <g id="stream">
          <rect x={14} y={10} height={73} width={4} fill="rgb(72, 22, 28)" />
        </g>
      </svg>
    </div>
  );
};
